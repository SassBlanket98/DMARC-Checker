<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced DMARC Checker</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #b22222;
        --primary-hover: #a11212;
        --background-color: #f9f9f9;
        --card-background: #ffffff;
        --text-color: #333;
        --error-color: #e74c3c;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --info-color: #3498db;
        --border-color: #ddd;
      }

      /* Dark mode variables */
      .dark-mode {
        --primary-color: #d32f2f;
        --primary-hover: #b71c1c;
        --background-color: #121212;
        --card-background: #1e1e1e;
        --text-color: #e0e0e0;
        --error-color: #e57373;
        --success-color: #81c784;
        --warning-color: #ffd54f;
        --info-color: #64b5f6;
        --border-color: #424242;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        transition: background-color 0.3s, color 0.3s;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--background-color);
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        color: var(--text-color);
      }

      header {
        background-color: var(--primary-color);
        color: white;
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      .app-title {
        display: flex;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
      }

      .app-title i {
        margin-right: 10px;
      }

      nav ul {
        list-style-type: none;
        display: flex;
      }

      nav ul li {
        margin-left: 20px;
      }

      nav ul li a {
        color: white;
        text-decoration: none;
        font-size: 1rem;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 4px;
        transition: background-color 0.3s;
      }

      nav ul li a:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      main {
        flex: 1;
        max-width: 1200px;
        width: 100%;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .controls {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 1rem;
      }

      .theme-toggle {
        background: none;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        font-size: 1.2rem;
        padding: 5px;
      }

      .container {
        background: var(--card-background);
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        border-top: 5px solid var(--primary-color);
      }

      .container h2 {
        margin-bottom: 1.5rem;
        color: var(--primary-color);
        font-size: 1.5rem;
        font-weight: 600;
      }

      .input-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }

      .input-wrapper {
        flex: 1;
        min-width: 200px;
        position: relative;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        font-size: 1rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--card-background);
        color: var(--text-color);
        transition: border-color 0.3s;
      }

      input:focus,
      select:focus {
        border-color: var(--primary-color);
        outline: none;
      }

      .domain-autocomplete {
        position: absolute;
        width: 100%;
        background: var(--card-background);
        border: 1px solid var(--border-color);
        border-top: none;
        border-radius: 0 0 6px 6px;
        z-index: 10;
        max-height: 200px;
        overflow-y: auto;
        display: none;
      }

      .domain-autocomplete div {
        padding: 10px;
        cursor: pointer;
      }

      .domain-autocomplete div:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      .dark-mode .domain-autocomplete div:hover {
        background-color: rgba(255, 255, 255, 0.05);
      }

      .button-group {
        display: flex;
        gap: 10px;
      }

      button {
        padding: 12px 20px;
        font-size: 1rem;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      button:hover {
        background-color: var(--primary-hover);
      }

      button.secondary {
        background-color: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
      }

      button.secondary:hover {
        background-color: rgba(178, 34, 34, 0.1);
      }

      /* Custom selectors input for DKIM */
      .selectors-container {
        display: none;
        margin-top: 15px;
      }

      .selectors-container.visible {
        display: block;
      }

      .selectors-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .selector-tag {
        display: flex;
        align-items: center;
        background: var(--primary-color);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
      }

      .selector-tag i {
        margin-left: 5px;
        cursor: pointer;
      }

      .add-selector {
        display: flex;
        margin-top: 10px;
        gap: 10px;
      }

      .add-selector input {
        flex: 1;
      }

      /* Results Section */
      .results {
        margin-top: 2rem;
      }

      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100px;
      }

      .spinner {
        border: 3px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 3px solid var(--primary-color);
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin-right: 15px;
      }

      .dark-mode .spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top: 3px solid var(--primary-color);
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .record-card {
        background: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        overflow: hidden;
      }

      .record-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
      }

      .record-header h3 {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.2rem;
        margin: 0;
      }

      .record-body {
        padding: 0;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
      }

      .record-body.expanded {
        padding: 20px;
        max-height: 2000px;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
      }

      .status-success {
        background-color: rgba(46, 204, 113, 0.2);
        color: var(--success-color);
      }

      .status-error {
        background-color: rgba(231, 76, 60, 0.2);
        color: var(--error-color);
      }

      .status-warning {
        background-color: rgba(243, 156, 18, 0.2);
        color: var(--warning-color);
      }

      .status-info {
        background-color: rgba(52, 152, 219, 0.2);
        color: var(--info-color);
      }

      .tabs {
        display: flex;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 15px;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.3s;
      }

      .tab.active {
        border-bottom: 2px solid var(--primary-color);
        color: var(--primary-color);
        font-weight: 500;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .record-data pre {
        background: rgba(0, 0, 0, 0.05);
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .dark-mode .record-data pre {
        background: rgba(255, 255, 255, 0.05);
      }

      .parsed-data {
        margin-top: 20px;
      }

      .parsed-data table {
        width: 100%;
        border-collapse: collapse;
      }

      .parsed-data th,
      .parsed-data td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .parsed-data th {
        font-weight: 600;
        color: var(--primary-color);
      }

      .recommendation {
        margin-top: 20px;
        padding: 15px;
        border-radius: 6px;
        background-color: rgba(52, 152, 219, 0.1);
        border-left: 4px solid var(--info-color);
      }

      .recommendation h4 {
        color: var(--info-color);
        margin-bottom: 10px;
      }

      .action-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 15px;
      }

      .badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        margin-left: 5px;
        background-color: var(--primary-color);
        color: white;
      }

      /* Score visualization */
      .score-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px 0;
      }

      .score-circle {
        position: relative;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: conic-gradient(
          var(--success-color) 0% var(--score-percent),
          #ddd var(--score-percent) 100%
        );
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .score-circle::before {
        content: "";
        position: absolute;
        width: 90px;
        height: 90px;
        border-radius: 50%;
        background-color: var(--card-background);
      }

      .score-value {
        position: relative;
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--text-color);
      }

      .score-label {
        margin-top: 15px;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-color);
      }

      .score-details {
        display: flex;
        justify-content: space-between;
        width: 100%;
        max-width: 400px;
        margin-top: 20px;
      }

      .score-item {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .score-item-label {
        font-size: 0.9rem;
        color: var(--text-color);
        margin-bottom: 5px;
      }

      .score-item-value {
        font-size: 1.2rem;
        font-weight: 600;
      }

      /* Issues and recommendations */
      .issues-container {
        margin: 20px 0;
      }

      .issue-item {
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 10px;
        display: flex;
        align-items: flex-start;
        gap: 10px;
      }

      .issue-icon {
        font-size: 1.2rem;
        padding-top: 3px;
      }

      .issue-content {
        flex: 1;
      }

      .issue-title {
        font-weight: 600;
        margin-bottom: 5px;
      }

      .issue-description {
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .issue-critical {
        background-color: rgba(231, 76, 60, 0.1);
        border-left: 4px solid var(--error-color);
      }

      .issue-critical .issue-icon {
        color: var(--error-color);
      }

      .issue-warning {
        background-color: rgba(243, 156, 18, 0.1);
        border-left: 4px solid var(--warning-color);
      }

      .issue-warning .issue-icon {
        color: var(--warning-color);
      }

      .issue-info {
        background-color: rgba(52, 152, 219, 0.1);
        border-left: 4px solid var(--info-color);
      }

      .issue-info .issue-icon {
        color: var(--info-color);
      }

      /* History drawer */
      .history-drawer {
        position: fixed;
        top: 0;
        right: -350px;
        width: 350px;
        height: 100vh;
        background-color: var(--card-background);
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
      }

      .history-drawer.open {
        right: 0;
      }

      .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        background-color: var(--card-background);
        z-index: 10;
      }

      .drawer-close {
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: var(--text-color);
      }

      .history-list {
        padding: 15px;
      }

      .history-item {
        padding: 10px;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .history-item:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      .dark-mode .history-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
      }

      .history-domain {
        font-weight: 500;
        margin-bottom: 5px;
      }

      .history-date {
        font-size: 0.8rem;
        color: #777;
      }

      .history-record-type {
        font-size: 0.8rem;
        display: inline-block;
        padding: 2px 6px;
        background-color: rgba(178, 34, 34, 0.1);
        color: var(--primary-color);
        border-radius: 3px;
        margin-left: 5px;
      }

      /* Help modal */
      .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
      }

      .modal-backdrop.open {
        opacity: 1;
        visibility: visible;
      }

      .modal {
        background-color: var(--card-background);
        border-radius: 8px;
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        transform: translateY(-20px);
        transition: transform 0.3s;
      }

      .modal-backdrop.open .modal {
        transform: translateY(0);
      }

      .modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--primary-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: var(--text-color);
      }

      .modal-body {
        padding: 20px;
      }

      .modal-section {
        margin-bottom: 20px;
      }

      .modal-section h3 {
        margin-bottom: 10px;
        color: var(--primary-color);
      }

      /* Export options */
      .export-options {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      /* Footer */
      footer {
        background-color: var(--primary-color);
        color: white;
        text-align: center;
        padding: 1.5rem 0;
        margin-top: 2rem;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .header-container {
          flex-direction: column;
          padding: 1rem;
        }

        .app-title {
          margin-bottom: 1rem;
        }

        nav ul {
          flex-wrap: wrap;
          justify-content: center;
        }

        nav ul li {
          margin: 5px;
        }

        .input-group {
          flex-direction: column;
          gap: 15px;
        }

        .button-group {
          flex-direction: column;
          width: 100%;
        }

        button {
          width: 100%;
        }

        .record-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .history-drawer {
          width: 85%;
          right: -85%;
        }

        .score-details {
          flex-direction: column;
          align-items: center;
          gap: 20px;
        }
      }

      /* Tooltips */
      .tooltip {
        position: relative;
        display: inline-block;
        cursor: help;
        margin-left: 5px;
      }

      .tooltip i {
        font-size: 1rem;
        color: var(--primary-color);
      }

      .tooltip .tooltip-text {
        visibility: hidden;
        width: 250px;
        background-color: var(--card-background);
        color: var(--text-color);
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-color);
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }

      .tooltip .tooltip-text::after {
        content: " ";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: var(--border-color) transparent transparent transparent;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-container">
        <div class="app-title">
          <i class="fas fa-shield-alt"></i>
          <span>Enhanced DMARC Checker</span>
        </div>
        <nav>
          <ul>
            <li>
              <a href="#" class="active"><i class="fas fa-home"></i> Home</a>
            </li>
            <li>
              <a href="#" id="help-link"
                ><i class="fas fa-question-circle"></i> Help</a
              >
            </li>
            <li>
              <a href="#" id="history-link"
                ><i class="fas fa-history"></i> History</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <div class="controls">
        <button class="theme-toggle" aria-label="Toggle dark mode">
          <i class="fas fa-moon"></i>
        </button>
      </div>

      <div class="container">
        <h2>Email Authentication Record Checker</h2>
        <div class="input-group">
          <div class="input-wrapper">
            <input
              type="text"
              id="domain"
              placeholder="Enter a domain (e.g., example.com)"
              autocomplete="off"
            />
            <div class="domain-autocomplete" id="domain-suggestions"></div>
          </div>
          <div class="input-wrapper">
            <select id="recordType">
              <option value="overview">Overview (All Records)</option>
              <option value="dmarc">DMARC</option>
              <option value="spf">SPF</option>
              <option value="dkim">DKIM</option>
              <option value="dns">DNS</option>
            </select>
          </div>
        </div>

        <div id="selectors-container" class="selectors-container">
          <h3>
            DKIM Selectors
            <span class="tooltip"
              ><i class="fas fa-info-circle"></i>
              <span class="tooltip-text"
                >Specify DKIM selectors to check. Common selectors include:
                default, google, selector1, selector2, email, dkim1</span
              >
            </span>
          </h3>
          <div class="selectors-list" id="selectors-list">
            <!-- Selector tags will be added here -->
          </div>
          <div class="add-selector">
            <input
              type="text"
              id="new-selector"
              placeholder="Enter a selector"
            />
            <button id="add-selector-btn" class="secondary">Add</button>
          </div>
        </div>

        <div class="button-group">
          <button id="check-btn" onclick="checkRecord()">
            <i class="fas fa-search"></i> Check Records
          </button>
          <button id="batch-check-btn" class="secondary">
            <i class="fas fa-layer-group"></i> Batch Check
          </button>
          <button id="export-btn" class="secondary">
            <i class="fas fa-file-export"></i> Export Results
          </button>
        </div>
      </div>

      <div id="overview-container" class="container" style="display: none">
        <h2>Authentication Score</h2>
        <div class="score-container">
          <div class="score-circle" style="--score-percent: 75%">
            <div class="score-value">75%</div>
          </div>
          <div class="score-label">Email Authentication Score</div>

          <div class="score-details">
            <div class="score-item">
              <div class="score-item-label">DMARC</div>
              <div class="score-item-value" style="color: var(--success-color)">
                <i class="fas fa-check-circle"></i>
              </div>
            </div>
            <div class="score-item">
              <div class="score-item-label">SPF</div>
              <div class="score-item-value" style="color: var(--success-color)">
                <i class="fas fa-check-circle"></i>
              </div>
            </div>
            <div class="score-item">
              <div class="score-item-label">DKIM</div>
              <div class="score-item-value" style="color: var(--warning-color)">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
            </div>
            <div class="score-item">
              <div class="score-item-label">MX</div>
              <div class="score-item-value" style="color: var(--success-color)">
                <i class="fas fa-check-circle"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="issues-container">
          <h3>Issues & Recommendations</h3>

          <div class="issue-item issue-warning">
            <div class="issue-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="issue-content">
              <div class="issue-title">DMARC Policy set to 'none'</div>
              <div class="issue-description">
                Your DMARC policy is currently set to 'none', which only
                monitors emails without taking action on failures. For better
                protection, consider upgrading to 'quarantine' or 'reject'.
              </div>
            </div>
          </div>

          <div class="issue-item issue-info">
            <div class="issue-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <div class="issue-content">
              <div class="issue-title">
                Missing DKIM Records for Common Selectors
              </div>
              <div class="issue-description">
                We couldn't find DKIM records for some common selectors. Try
                adding selectors specifically used by your email service
                provider.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <h2>Record Details</h2>
        <div class="results">
          <div id="result">
            Enter a domain and check records to see results here.
          </div>
        </div>
      </div>
    </main>

    <!-- History Drawer -->
    <div id="history-drawer" class="history-drawer">
      <div class="drawer-header">
        <h2>Recent Lookups</h2>
        <button class="drawer-close" id="history-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="history-list">
        <!-- Sample history items -->
        <div class="history-item">
          <div class="history-domain">example.com</div>
          <div class="history-date">
            February 27, 2025 - 10:23 AM
            <span class="history-record-type">Overview</span>
          </div>
        </div>
        <div class="history-item">
          <div class="history-domain">example.org</div>
          <div class="history-date">
            February 27, 2025 - 10:20 AM
            <span class="history-record-type">DMARC</span>
          </div>
        </div>
        <div class="history-item">
          <div class="history-domain">google.com</div>
          <div class="history-date">
            February 27, 2025 - 10:15 AM
            <span class="history-record-type">SPF</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal-backdrop">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">DMARC Checker Help & Information</div>
          <button class="modal-close" id="help-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-section">
            <h3>What is Email Authentication?</h3>
            <p>
              Email authentication is a set of techniques to verify the identity
              of email senders, prevent email spoofing, and reduce spam and
              phishing attacks. The primary authentication methods are:
            </p>
            <ul>
              <li>
                <strong
                  >DMARC (Domain-based Message Authentication, Reporting &
                  Conformance)</strong
                >
                - A policy framework that builds on SPF and DKIM to improve
                protection against spoofing and phishing.
              </li>
              <li>
                <strong>SPF (Sender Policy Framework)</strong> - Verifies that
                email messages are sent from authorized mail servers.
              </li>
              <li>
                <strong>DKIM (DomainKeys Identified Mail)</strong> - Adds a
                digital signature to emails that can be validated by receiving
                mail servers.
              </li>
            </ul>
          </div>

          <div class="modal-section">
            <h3>How to Use This Tool</h3>
            <ol>
              <li>
                Enter a domain name (e.g., example.com) in the domain field.
              </li>
              <li>
                Select the record type you want to check (or use "Overview" to
                check all records).
              </li>
              <li>
                If checking DKIM records, you can specify selectors to check.
              </li>
              <li>
                Click "Check Records" to retrieve and analyze the domain's
                records.
              </li>
              <li>
                View the results, recommendations, and email authentication
                score.
              </li>
            </ol>
          </div>

          <div class="modal-section">
            <h3>Understanding Results</h3>
            <p>The tool provides the following information:</p>
            <ul>
              <li>
                <strong>Authentication Score</strong> - An overall score based
                on the implementation of email authentication methods.
              </li>
              <li>
                <strong>Record Details</strong> - Both raw and parsed data for
                each record type.
              </li>
              <li>
                <strong>Issues & Recommendations</strong> - Identified issues
                and suggestions to improve email authentication.
              </li>
            </ul>
          </div>

          <div class="modal-section">
            <h3>Common DKIM Selectors</h3>
            <p>
              DKIM selectors are used to retrieve the public key for validating
              email signatures. Common selectors by service:
            </p>
            <ul>
              <li>
                <strong>Google Workspace / Gmail</strong>: google, 20161025,
                20150623
              </li>
              <li><strong>Microsoft 365</strong>: selector1, selector2</li>
              <li><strong>Amazon SES</strong>: amazonses</li>
              <li><strong>Mailchimp</strong>: k1, k2, k3</li>
              <li><strong>SendGrid</strong>: s1, s2</li>
              <li><strong>Zoho</strong>: zoho</li>
              <li>
                <strong>Others</strong>: default, dkim, mail, email, dkim1
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>&copy; 2025 Enhanced DMARC Checker | All Rights Reserved</p>
    </footer>

    <script>
      // Toggle dark mode
      document
        .querySelector(".theme-toggle")
        .addEventListener("click", function () {
          document.body.classList.toggle("dark-mode");
          const icon = this.querySelector("i");
          if (document.body.classList.contains("dark-mode")) {
            icon.classList.remove("fa-moon");
            icon.classList.add("fa-sun");
          } else {
            icon.classList.remove("fa-sun");
            icon.classList.add("fa-moon");
          }
        });

      // Record type change handler
      document
        .getElementById("recordType")
        .addEventListener("change", function () {
          const selectorsContainer = document.getElementById(
            "selectors-container"
          );
          if (this.value === "dkim") {
            selectorsContainer.classList.add("visible");
          } else {
            selectorsContainer.classList.remove("visible");
          }
        });

      // DKIM Selectors handling
      const selectorsData = [
        "default",
        "google",
        "selector1",
        "selector2",
        "email",
        "dkim1",
      ];
      const selectorsList = document.getElementById("selectors-list");
      const newSelectorInput = document.getElementById("new-selector");
      const addSelectorBtn = document.getElementById("add-selector-btn");

      // Add initial selectors
      selectorsData.forEach((selector) => {
        addSelectorTag(selector);
      });

      // Add selector tag function
      function addSelectorTag(selector) {
        if (!selector) return;

        const tag = document.createElement("div");
        tag.className = "selector-tag";
        tag.innerHTML = `
                ${selector}
                <i class="fas fa-times" onclick="removeSelector(this)"></i>
            `;
        selectorsList.appendChild(tag);
      }

      // Remove selector function
      function removeSelector(element) {
        element.parentElement.remove();
      }

      // Add new selector
      addSelectorBtn.addEventListener("click", function () {
        const selector = newSelectorInput.value.trim();
        if (selector) {
          addSelectorTag(selector);
          newSelectorInput.value = "";
        }
      });

      // Add selector on Enter key
      newSelectorInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          const selector = this.value.trim();
          if (selector) {
            addSelectorTag(selector);
            this.value = "";
          }
        }
      });

      // History drawer toggle
      document
        .getElementById("history-link")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("history-drawer").classList.add("open");
        });

      document
        .getElementById("history-close")
        .addEventListener("click", function () {
          document.getElementById("history-drawer").classList.remove("open");
        });

      // Help modal toggle
      document
        .getElementById("help-link")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("help-modal").classList.add("open");
        });

      document
        .getElementById("help-close")
        .addEventListener("click", function () {
          document.getElementById("help-modal").classList.remove("open");
        });

      // Domain input autocomplete - recent domains
      const recentDomains = [
        "example.com",
        "google.com",
        "microsoft.com",
        "apple.com",
        "amazon.com",
      ];
      const domainInput = document.getElementById("domain");
      const domainSuggestions = document.getElementById("domain-suggestions");

      domainInput.addEventListener("input", function () {
        const input = this.value.toLowerCase();
        domainSuggestions.innerHTML = "";

        if (input.length > 1) {
          const filtered = recentDomains.filter((domain) =>
            domain.toLowerCase().includes(input)
          );

          if (filtered.length > 0) {
            filtered.forEach((domain) => {
              const div = document.createElement("div");
              div.textContent = domain;
              div.addEventListener("click", function () {
                domainInput.value = domain;
                domainSuggestions.style.display = "none";
              });
              domainSuggestions.appendChild(div);
            });
            domainSuggestions.style.display = "block";
          } else {
            domainSuggestions.style.display = "none";
          }
        } else {
          domainSuggestions.style.display = "none";
        }
      });

      // Hide suggestions when clicking outside
      document.addEventListener("click", function (event) {
        if (
          !domainInput.contains(event.target) &&
          !domainSuggestions.contains(event.target)
        ) {
          domainSuggestions.style.display = "none";
        }
      });

      // Export Results
      document
        .getElementById("export-btn")
        .addEventListener("click", function () {
          // In a real implementation, this would generate a file with the results
          alert(
            "This would export the current results to a JSON or PDF file in a complete implementation."
          );
        });

      // Batch Check
      document
        .getElementById("batch-check-btn")
        .addEventListener("click", function () {
          // In a real implementation, this would open a modal for entering multiple domains
          alert(
            "This would open a dialog to check multiple domains at once in a complete implementation."
          );
        });

      // Record checking function - core functionality
      async function checkRecord() {
        const domain = document.getElementById("domain").value.trim();
        const recordType = document.getElementById("recordType").value;
        const resultBox = document.getElementById("result");
        const overviewContainer = document.getElementById("overview-container");

        // Validate domain input
        if (!domain) {
          resultBox.innerHTML = `
                    <div class="issue-item issue-error">
                        <div class="issue-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="issue-content">
                            <div class="issue-title">Invalid Input</div>
                            <div class="issue-description">
                                Please enter a valid domain name.
                            </div>
                        </div>
                    </div>
                `;
          overviewContainer.style.display = "none";
          return;
        }

        // Get DKIM selectors if applicable
        let selectors = [];
        if (recordType === "dkim") {
          const selectorTags = document.querySelectorAll(".selector-tag");
          selectorTags.forEach((tag) => {
            selectors.push(tag.textContent.trim());
          });
        }

        // Construct API URL
        const url =
          recordType === "overview"
            ? `/api/overview?domain=${domain}`
            : `/api/${recordType}?domain=${domain}${
                recordType === "dkim" && selectors.length
                  ? "&selectors=" + selectors.join(",")
                  : ""
              }`;

        // Show loading state
        resultBox.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <div>Loading records for ${domain}...</div>
                </div>
            `;
        overviewContainer.style.display = "none";

        try {
          // Fetch data from API
          const response = await fetch(url);
          const data = await response.json();

          // Add to history (in a real implementation, this would be stored in localStorage)
          addToHistory(domain, recordType);

          // Handle API response
          if (response.ok) {
            if (recordType === "overview") {
              // Display overview score container
              overviewContainer.style.display = "block";

              // Render records
              resultBox.innerHTML = renderDetailedRecords(data.records);
            } else {
              // Render single record
              resultBox.innerHTML = renderDetailedRecord(recordType, data);
            }
          } else {
            resultBox.innerHTML = `
                        <div class="issue-item issue-error">
                            <div class="issue-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="issue-content">
                                <div class="issue-title">API Error</div>
                                <div class="issue-description">
                                    ${
                                      data.error ||
                                      "Failed to fetch data from the server."
                                    }
                                </div>
                            </div>
                        </div>
                    `;
          }
        } catch (error) {
          resultBox.innerHTML = `
                    <div class="issue-item issue-error">
                        <div class="issue-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="issue-content">
                            <div class="issue-title">Error</div>
                            <div class="issue-description">
                                ${
                                  error.message ||
                                  "An unexpected error occurred."
                                }
                            </div>
                        </div>
                    </div>
                `;
        }
      }

      // Add a domain check to history
      function addToHistory(domain, recordType) {
        const historyList = document.querySelector(".history-list");
        const now = new Date();
        const timeString = now.toLocaleString();

        const historyItem = document.createElement("div");
        historyItem.className = "history-item";
        historyItem.innerHTML = `
                <div class="history-domain">${domain}</div>
                <div class="history-date">${timeString} <span class="history-record-type">${recordType.toUpperCase()}</span></div>
            `;

        historyItem.addEventListener("click", function () {
          document.getElementById("domain").value = domain;
          document.getElementById("recordType").value = recordType;
          document.getElementById("history-drawer").classList.remove("open");
          checkRecord();
        });

        // Add at the top of the list
        historyList.insertBefore(historyItem, historyList.firstChild);
      }

      // Toggle record card expansion
      function toggleRecordCard(id) {
        const body = document.getElementById(id);
        body.classList.toggle("expanded");

        const header = body.previousElementSibling;
        const icon = header.querySelector(".expand-icon");

        if (body.classList.contains("expanded")) {
          icon.classList.remove("fa-chevron-down");
          icon.classList.add("fa-chevron-up");
        } else {
          icon.classList.remove("fa-chevron-up");
          icon.classList.add("fa-chevron-down");
        }
      }

      // Switch tabs in record cards
      function switchTab(recordId, tabName) {
        // Hide all tab contents in this record
        const tabContents = document.querySelectorAll(
          `#${recordId} .tab-content`
        );
        tabContents.forEach((tab) => tab.classList.remove("active"));

        // Remove active class from all tabs
        const tabs = document.querySelectorAll(`#${recordId}-tabs .tab`);
        tabs.forEach((tab) => tab.classList.remove("active"));

        // Show selected tab
        document
          .getElementById(`${recordId}-${tabName}`)
          .classList.add("active");
        document
          .querySelector(`#${recordId}-tabs .tab[data-tab="${tabName}"]`)
          .classList.add("active");
      }

      // Copy record data to clipboard
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            // Show a success message
            alert("Copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
            alert("Failed to copy text. Please try again.");
          });
      }

      // Render multiple records for overview
      function renderDetailedRecords(records) {
        if (!records || !Array.isArray(records) || records.length === 0) {
          return "<div class='error'>No records found for this domain.</div>";
        }

        return records
          .map((record, index) => renderDetailedRecordCard(record, index))
          .join("");
      }

      // Render a single record
      function renderDetailedRecord(recordType, data) {
        const record = {
          title: recordType.toUpperCase(),
          value: data,
          parsed_record: data.parsed_record || {},
          status: data.error ? "error" : "success",
        };

        return renderDetailedRecordCard(record, 0);
      }

      // Render a detailed record card with tabs
      function renderDetailedRecordCard(record, index) {
        const recordId = `record-${index}`;
        const statusClass =
          record.status === "error" ? "status-error" : "status-success";
        const statusText = record.status === "error" ? "Error" : "Success";
        const statusIcon =
          record.status === "error" ? "exclamation-circle" : "check-circle";

        // Determine recommendations based on record type and content
        let recommendations = "";
        if (record.title === "DMARC" && record.status === "success") {
          const p = record.parsed_record.p || "";
          if (p === "none") {
            recommendations = `
                        <div class="recommendation">
                            <h4>Recommendation</h4>
                            <p>Your DMARC policy is set to 'none', which only monitors emails without taking action on failures. For better security, consider upgrading to 'quarantine' or 'reject' once you've verified that legitimate emails are passing DMARC checks.</p>
                        </div>
                    `;
          }
        } else if (record.title === "SPF" && record.status === "success") {
          if (
            record.value.spf_record &&
            record.value.spf_record.includes("~all")
          ) {
            recommendations = `
                        <div class="recommendation">
                            <h4>Recommendation</h4>
                            <p>Your SPF record uses a soft fail (~all) mechanism. For stronger protection against email spoofing, consider using a hard fail (-all) once you've verified all legitimate email sources are included in your SPF record.</p>
                        </div>
                    `;
          }
        }

        // Parse record details for detailed view
        let parsedDetails = "";
        if (
          record.parsed_record &&
          Object.keys(record.parsed_record).length > 0
        ) {
          parsedDetails = `
                    <table>
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(record.parsed_record)
                              .map(
                                ([key, value]) => `
                                <tr>
                                    <td><strong>${key}</strong></td>
                                    <td>${value || "N/A"}</td>
                                    <td>${getExplanation(
                                      key,
                                      record.title.toLowerCase()
                                    )}</td>
                                </tr>
                            `
                              )
                              .join("")}
                        </tbody>
                    </table>
                `;
        } else {
          parsedDetails = "<p>No parsed details available.</p>";
        }

        return `
                <div class="record-card">
                    <div class="record-header" onclick="toggleRecordCard('${recordId}-body')">
                        <h3>
                            <i class="fas fa-shield-alt"></i>
                            ${record.title}
                        </h3>
                        <div class="record-controls">
                            <span class="status-indicator ${statusClass}">
                                <i class="fas fa-${statusIcon}"></i>
                                ${statusText}
                            </span>
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                    </div>
                    <div class="record-body" id="${recordId}-body">
                        <div class="tabs" id="${recordId}-tabs">
                            <div class="tab active" data-tab="raw" onclick="switchTab('${recordId}', 'raw')">Raw Data</div>
                            <div class="tab" data-tab="parsed" onclick="switchTab('${recordId}', 'parsed')">Parsed Details</div>
                            <div class="tab" data-tab="recommendations" onclick="switchTab('${recordId}', 'recommendations')">Recommendations</div>
                        </div>
                        
                        <div class="tab-content active" id="${recordId}-raw">
                            <div class="record-data">
                                <pre>${JSON.stringify(
                                  record.value,
                                  null,
                                  2
                                )}</pre>
                                <div class="action-buttons">
                                    <button class="secondary" onclick="copyToClipboard('${JSON.stringify(
                                      record.value
                                    ).replace(/'/g, "\\'")}')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="${recordId}-parsed">
                            <div class="parsed-data">
                                ${parsedDetails}
                            </div>
                        </div>
                        
                        <div class="tab-content" id="${recordId}-recommendations">
                            ${
                              recommendations ||
                              `<p>No specific recommendations available for this ${record.title} record.</p>`
                            }
                        </div>
                    </div>
                </div>
            `;
      }

      // Record explanations
      function getExplanation(key, recordType) {
        const explanations = {
          dmarc: {
            v: "Version of the DMARC policy",
            p: "Policy for emails failing DMARC checks (e.g., 'none', 'quarantine', 'reject')",
            sp: "Policy for subdomains failing DMARC checks",
            pct: "Percentage of emails to which the DMARC policy is applied",
            rua: "Aggregate report URIs (e.g., email addresses) where feedback is sent",
            ruf: "Forensic report URIs for individual failure events",
            adkim: "Alignment mode for DKIM (strict or relaxed)",
            aspf: "Alignment mode for SPF (strict or relaxed)",
            fo: "Failure options for DMARC failures",
            rf: "Report format for forensic reports",
            ri: "Interval for aggregate reports in seconds",
          },
          spf: {
            v: "Version of the SPF policy",
            "-all": "Defines a hard fail policy for unauthorized email sources",
            "~all": "Defines a soft fail policy for unauthorized email sources",
            "?all": "Defines a neutral policy for unauthorized email sources",
            "+all":
              "Defines a policy to allow all email sources (not recommended)",
            ip4: "Specifies an IPv4 address range allowed to send emails",
            ip6: "Specifies an IPv6 address range allowed to send emails",
            a: "Allows all A records in the domain to send emails",
            mx: "Allows all MX records in the domain to send emails",
            redirect: "Redirects to another domain for SPF checks",
            include: "Includes another domain for SPF checks",
          },
          dkim: {
            v: "Version of the DKIM policy",
            k: "Key type used for DKIM signing (e.g., 'rsa')",
            p: "Public key used for verifying DKIM signatures",
            s: "Service type (e.g., email)",
            t: "Flags indicating testing mode",
            h: "Headers included in the DKIM signature",
          },
          dns: {
            A: "IPv4 address records for the domain",
            AAAA: "IPv6 address records for the domain",
            MX: "Mail exchange server records for the domain",
            TXT: "Text records containing metadata for the domain",
          },
        };

        return explanations[recordType]?.[key] || "No explanation available";
      }

      // Initialize the page with enterkey handler
      document.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          checkRecord();
        }
      });
    </script>
  </body>
</html>
